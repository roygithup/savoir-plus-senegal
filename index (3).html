<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVT Excellence | R√©ussir le BAC & BFEM</title>
    <meta name="description" content="La plateforme n¬∞1 pour exceller en SVT au S√©n√©gal. Cours, vid√©os et exercices pour Terminale et 3√®me.">
    
    <!-- Biblioth√®ques -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Configuration Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 
                            500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a'
                        },
                        quiz: {
                            50: '#f5f3ff', 100: '#ede9fe', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9'
                        },
                        accent: {
                            500: '#f59e0b', 600: '#d97706' // Amber for premium
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Effets de verre et utilitaires */
        .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(226, 232, 240, 0.6); }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px); }
        
        .course-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .course-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px -12px rgba(37, 99, 235, 0.15); border-color: #bfdbfe; }
        
        .shimmer { background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        
        .text-gradient { background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Quiz Styling */
        .option-label { cursor: pointer; transition: all 0.2s; }
        .option-radio:checked + .option-content { border-color: #7c3aed; background-color: #f5f3ff; color: #5b21b6; font-weight: 700; box-shadow: 0 4px 6px -1px rgba(124, 58, 237, 0.1); }
        
        .correct-answer { border-color: #10b981 !important; background-color: #ecfdf5 !important; color: #065f46 !important; }
        .wrong-answer { border-color: #ef4444 !important; background-color: #fef2f2 !important; color: #991b1b !important; }
        
        /* Smooth transitions for quiz questions */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen font-sans antialiased selection:bg-brand-100 selection:text-brand-900 flex flex-col">

    <!-- TOAST NOTIFICATIONS CONTAINER -->
    <div id="toastContainer" class="fixed top-24 right-6 z-[200] flex flex-col gap-3 pointer-events-none"></div>

    <!-- NAVIGATION -->
    <nav class="glass-nav sticky top-0 z-50 px-6 py-4 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="window.location.reload()">
                <div class="bg-gradient-to-br from-brand-600 to-brand-700 p-2.5 rounded-xl text-white shadow-lg shadow-brand-200 group-hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-dna text-xl"></i>
                </div>
                <div class="flex flex-col">
                    <span class="text-xl font-extrabold tracking-tight text-slate-900 leading-none">SVT<span class="text-brand-600">Excellence</span></span>
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">S√©n√©gal</span>
                </div>
            </div>

            <div class="flex items-center gap-4">
<div id="navAuthButtons" class="flex items-center gap-2">
    <button onclick="orderManual()" class="hidden lg:flex items-center gap-2 bg-amber-50 text-amber-700 px-4 py-2 rounded-xl font-bold text-xs border border-amber-200 hover:bg-amber-100 hover:border-amber-300 transition shadow-sm mr-2 animate-pulse-slow">
        <i class="fas fa-book-open"></i>
        <span>Commander le Manuel</span>
    </button>
    
    <button onclick="orderManual()" class="lg:hidden text-amber-600 w-10 h-10 flex items-center justify-center rounded-full bg-amber-50 border border-amber-100 mr-1">
        <i class="fas fa-book"></i>
    </button>

    <button onclick="showAuthModal('login')" class="hidden md:block text-slate-600 font-bold text-sm hover:text-brand-600 px-4 py-2 transition">Connexion</button>
    <button onclick="showAuthModal('signup')" class="bg-brand-600 text-white px-5 py-2.5 rounded-xl font-bold text-sm shadow-xl shadow-brand-100 hover:bg-brand-700 hover:shadow-brand-200 transition transform hover:-translate-y-0.5 active:translate-y-0">
        <span class="hidden md:inline">S'inscrire</span>
        <span class="md:hidden"><i class="fas fa-user-plus"></i></span>
    </button>
</div>
                <div id="navUserDisplay" class="hidden flex items-center gap-3 animate-slide-up">
                    <div class="flex items-center gap-3 bg-white px-3 py-1.5 rounded-full border border-slate-200 shadow-sm">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-brand-500 to-indigo-600 text-white flex items-center justify-center text-xs font-bold ring-2 ring-white" id="userInitialNav">?</div>
                        <div class="hidden md:flex flex-col">
                            <span id="userNameNav" class="text-xs font-bold text-slate-800 max-w-[100px] truncate leading-none">Utilisateur</span>
                            <span id="userClassNav" class="text-[9px] font-bold text-slate-400 uppercase tracking-wide leading-none mt-0.5">Classe</span>
                        </div>
                    </div>
                    <button onclick="logout()" class="text-slate-400 hover:text-red-500 hover:bg-red-50 w-10 h-10 flex items-center justify-center rounded-full transition border border-transparent hover:border-red-100" title="D√©connexion">
                        <i class="fas fa-power-off"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- BANNI√àRE BIENVENUE -->
    <div id="welcomeBanner" class="hidden bg-slate-900 text-white relative overflow-hidden">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
        <div class="absolute right-0 top-0 w-64 h-64 bg-brand-500/20 blur-[80px] rounded-full pointer-events-none"></div>
        
        <div class="max-w-7xl mx-auto px-6 py-6 relative z-10 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-brand-500 to-indigo-600 flex items-center justify-center font-black text-2xl text-white shadow-lg shadow-brand-900/50" id="userInitial">U</div>
                <div>
                    <p class="text-xs text-brand-300 font-bold uppercase tracking-widest mb-0.5">Espace √âl√®ve</p>
                    <p class="font-extrabold text-xl tracking-tight" id="welcomeUserText">Nom de l'√©l√®ve</p>
                </div>
            </div>
            <div class="bg-white/5 backdrop-blur-sm px-6 py-3 rounded-2xl text-sm font-medium text-slate-300 border border-white/10 flex items-center gap-4 max-w-xl">
                <i class="fas fa-lightbulb text-amber-400 text-lg"></i>
                <span id="motivationQuote">Chargement de votre dose de motivation...</span>
            </div>
        </div>
    </div>

    <!-- HERO SECTION -->
    <header class="bg-white border-b border-slate-200/60 px-6 py-16 md:py-24 relative overflow-hidden">
        <!-- Abstract Background Shapes -->
        <div class="absolute top-10 right-0 md:right-20 w-72 h-72 bg-purple-100 rounded-full blur-[100px] opacity-60 animate-float"></div>
        <div class="absolute bottom-0 left-0 md:left-20 w-96 h-96 bg-brand-50 rounded-full blur-[120px] opacity-70"></div>
        
        <div class="max-w-7xl mx-auto flex flex-col lg:flex-row items-center justify-between gap-12 relative z-10">
            <div class="lg:w-1/2 text-center lg:text-left">
                <div class="inline-flex items-center gap-2 bg-brand-50 text-brand-700 px-4 py-1.5 rounded-full text-[11px] font-black mb-6 border border-brand-100 tracking-wider uppercase shadow-sm">
                    <span class="w-2 h-2 rounded-full bg-brand-500 animate-pulse"></span>
                    Nouveau Programme 2024
                </div>
                <h1 class="text-4xl md:text-6xl font-black text-slate-900 mb-6 leading-[1.1] tracking-tight">
                    L'Excellence en SVT √† port√©e de main.
                </h1>
                <p class="text-slate-600 text-lg md:text-xl mb-8 leading-relaxed font-medium max-w-xl mx-auto lg:mx-0">
                    Acc√®de aux meilleures ressources pour le <span class="font-bold text-slate-900">BAC</span> et le <span class="font-bold text-slate-900">BFEM</span>. Cours structur√©s, sch√©mas HD et Quiz interactifs.
                </p>
                
                <div class="flex flex-col sm:flex-row items-center gap-4 justify-center lg:justify-start">
                    <div id="heroCTA" class="p-1.5 pl-5 pr-2 bg-white rounded-full border border-slate-200 shadow-xl flex items-center gap-4 max-w-md w-full sm:w-auto hover:border-brand-300 transition-colors cursor-default">
                        <div class="flex flex-col">
                            <span class="text-xs font-bold text-slate-400 uppercase tracking-wide">Prix unique</span>
                            <span class="text-xl font-black text-slate-900">2000 FCFA <span class="text-sm text-slate-400 font-medium">/mois</span></span>
                        </div>
                        <button onclick="showAuthModal('signup')" class="ml-auto bg-slate-900 text-white px-6 py-3 rounded-full font-bold text-sm hover:bg-brand-600 transition-colors">
                            Commencer
                        </button>
                    </div>
                </div>
                <p class="mt-4 text-xs font-bold text-slate-400 uppercase tracking-wide flex items-center justify-center lg:justify-start gap-2">
                    <i class="fas fa-check-circle text-emerald-500"></i> Inscription Gratuite
                    <span class="mx-2">‚Ä¢</span>
                    <i class="fas fa-check-circle text-emerald-500"></i> Acc√®s Imm√©diat
                </p>
            </div>

            <!-- Search & Filter Card -->
            <div class="lg:w-5/12 w-full">
                <div class="bg-white/80 backdrop-blur-xl p-6 md:p-8 rounded-[2rem] border border-white shadow-2xl shadow-brand-900/5 relative">
                    <div class="absolute -top-6 -right-6 w-20 h-20 bg-accent-500 rounded-3xl rotate-12 flex items-center justify-center text-white text-3xl shadow-lg animate-float hidden md:flex">
                        <i class="fas fa-graduation-cap"></i>
                    </div>

                    <h3 class="text-xl font-black text-slate-900 mb-6">Trouve ta le√ßon</h3>
                    
                    <div class="flex flex-col gap-5">
                        <div class="relative group">
                            <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-brand-500 transition-colors"></i>
                            <input type="text" id="searchInput" placeholder="Ex: Mitose, Tectonique..." class="w-full pl-12 pr-4 py-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-brand-100 focus:border-brand-500 outline-none transition font-semibold text-sm shadow-inner">
                        </div>
                        
                        <div>
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 ml-1">Filtrer par niveau</p>
                            <div class="grid grid-cols-2 gap-3" id="filterContainer">
                                <button data-filter="all" class="filter-btn active py-3 rounded-xl font-bold transition-all text-xs border border-transparent shadow-sm">Tout voir</button>
                                <button data-filter="Terminale" class="filter-btn py-3 rounded-xl font-bold transition-all text-xs border border-slate-200 hover:border-brand-300 bg-white text-slate-600 shadow-sm">Terminale</button>
                                <button data-filter="3√®me" class="filter-btn py-3 rounded-xl font-bold transition-all text-xs border border-slate-200 hover:border-brand-300 bg-white text-slate-600 shadow-sm">3√®me</button>
                                <button data-filter="free" class="filter-btn py-3 rounded-xl font-bold transition-all text-xs border border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 shadow-sm">Gratuit</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow max-w-7xl mx-auto px-6 py-16 w-full">
        <!-- Status & Loader -->
        <div id="statusContainer" class="hidden text-center py-20">
            <div id="loader" class="hidden flex flex-col items-center">
                <div class="w-16 h-16 border-4 border-slate-100 border-t-brand-600 rounded-full animate-spin mb-4"></div>
                <p class="font-bold text-slate-400 animate-pulse">Chargement des cours...</p>
            </div>
            <div id="noResults" class="hidden text-slate-400 max-w-md mx-auto">
                <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-search text-3xl text-slate-300"></i>
                </div>
                <h3 class="text-2xl font-black text-slate-800 mb-2">Aucun r√©sultat</h3>
                <p class="font-medium text-slate-500">Nous n'avons trouv√© aucune le√ßon correspondant √† ta recherche. Essaie un autre mot-cl√©.</p>
                <button onclick="resetFilters()" class="mt-6 text-brand-600 font-bold hover:underline">R√©initialiser les filtres</button>
            </div>
        </div>

        <!-- Course Grid -->
        <div id="coursesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Loading Skeletons -->
            <div class="shimmer h-[380px] rounded-[2.5rem] opacity-60"></div>
            <div class="shimmer h-[380px] rounded-[2.5rem] opacity-60"></div>
            <div class="shimmer h-[380px] rounded-[2.5rem] opacity-60"></div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-slate-900 text-white border-t border-slate-800 pt-16 pb-8">
        <div class="max-w-7xl mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12 mb-12">
                <div>
                    <div class="flex items-center gap-2 mb-4">
                        <div class="bg-brand-600 p-1.5 rounded-lg text-white">
                            <i class="fas fa-dna text-sm"></i>
                        </div>
                        <span class="text-lg font-bold">SVT Excellence</span>
                    </div>
                    <p class="text-slate-400 text-sm leading-relaxed max-w-xs">
                        La plateforme √©ducative de r√©f√©rence pour les √©l√®ves de 3√®me et Terminale au S√©n√©gal. Reussissez votre examen avec nos cours optimis√©s.
                    </p>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Liens Rapides</h4>
                    <ul class="space-y-2 text-sm text-slate-400">
                        <li><a href="#" class="hover:text-brand-400 transition">Programme Terminale</a></li>
                        <li><a href="#" class="hover:text-brand-400 transition">Programme 3√®me</a></li>
                        <li><a href="#" onclick="showAuthModal('signup')" class="hover:text-brand-400 transition">S'inscrire</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Besoin d'aide ?</h4>
                    <p class="text-slate-400 text-sm mb-4">Contacte l'administration pour activer ton compte.</p>
                    <button onclick="contactAdmin()" class="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-xl text-sm font-bold transition flex items-center gap-2">
                        <i class="fab fa-whatsapp"></i> Support WhatsApp
                    </button>
                </div>
            </div>
            <div class="border-t border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-slate-500 font-medium">
                <p>&copy; 2024 SVT Excellence S√©n√©gal. Tous droits r√©serv√©s.</p>
                <p>Fait avec <i class="fas fa-heart text-red-500 mx-1"></i> pour l'√©ducation.</p>
            </div>
        </div>
    </footer>

    <!-- MODAL AUTH -->
    <div id="authModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 sm:p-6 bg-slate-900/60 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white rounded-[2.5rem] p-8 md:p-10 max-w-md w-full shadow-2xl relative max-h-[90vh] overflow-y-auto animate-slide-up">
            <button onclick="closeAuthModal()" class="absolute top-6 right-6 text-slate-400 hover:text-slate-900 transition h-10 w-10 flex items-center justify-center bg-slate-50 hover:bg-slate-100 rounded-full">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center mb-8">
                <div id="authIconBox" class="w-16 h-16 bg-brand-50 text-brand-600 rounded-2xl flex items-center justify-center text-2xl mx-auto mb-4 shadow-inner ring-4 ring-brand-50/50">
                    <i id="authIcon" class="fas fa-user-graduate"></i>
                </div>
                <h2 id="authTitle" class="text-2xl font-black text-slate-900 leading-tight">Acc√®s El√®ve</h2>
                <p id="authSubtitle" class="text-slate-500 mt-2 font-medium text-sm">Identifie-toi pour acc√©der √† tes cours.</p>
            </div>

            <form id="authForm" onsubmit="handleAuth(event)" class="space-y-4">
                <div id="signupFields" class="hidden space-y-4">
                    <div class="bg-emerald-50 border border-emerald-100 p-3 rounded-xl mb-2 flex items-center gap-3">
                        <i class="fas fa-gift text-emerald-500 text-lg"></i>
                        <div>
                            <p class="text-xs text-emerald-800 font-bold uppercase tracking-wider">Compte Gratuit</p>
                            <p class="text-[10px] text-emerald-600 font-medium leading-tight">Obtiens ton ID unique imm√©diatement.</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-[11px] font-bold text-slate-400 uppercase tracking-wider mb-2 ml-1">Ton Pr√©nom et Nom</label>
                        <input type="text" id="regFullName" placeholder="Ex: Moussa Diop" class="w-full px-5 py-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 focus:bg-white outline-none transition font-bold text-slate-700">
                    </div>
                    <div>
                        <label class="block text-[11px] font-bold text-slate-400 uppercase tracking-wider mb-2 ml-1">Ta Classe</label>
                        <select id="regClasse" class="w-full px-5 py-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 focus:bg-white outline-none transition font-bold text-slate-700 cursor-pointer">
                            <option value="">Choisir...</option>
                            <option value="Terminale">Terminale</option>
                            <option value="3√®me">3√®me</option>
                        </select>
                    </div>
                </div>

                <div id="loginFields">
                    <div>
                        <label class="block text-[11px] font-bold text-slate-400 uppercase tracking-wider mb-2 text-center">Ton Identifiant (ID)</label>
                        <input type="text" id="loginID" maxlength="4" placeholder="ABCD" class="w-full px-5 py-5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition uppercase text-center text-3xl font-black tracking-[0.5em] shadow-inner text-brand-600 placeholder-slate-300">
                        <p class="text-center text-[10px] text-slate-400 mt-2">C'est le code √† 4 lettres re√ßu lors de l'inscription.</p>
                    </div>
                </div>
                
                <button type="submit" id="authSubmitBtn" class="w-full py-4 bg-brand-600 text-white rounded-xl font-bold shadow-lg shadow-brand-200 hover:bg-brand-700 hover:shadow-brand-300 transition transform hover:-translate-y-0.5 active:translate-y-0 flex items-center justify-center gap-2 mt-2">
                    <span id="authBtnLabel">Se connecter</span>
                    <i class="fas fa-arrow-right text-xs"></i>
                </button>
            </form>

            <div class="mt-6 pt-6 border-t border-slate-100 text-center">
                <p class="text-xs font-bold text-slate-400">
                    <span id="authFooterText">Pas encore de compte ?</span>
                    <button onclick="toggleAuthMode()" id="authFooterBtn" class="text-brand-600 font-black hover:underline ml-1">Cr√©er un compte</button>
                </p>
            </div>
        </div>
    </div>

    <!-- MODAL QUIZ -->
    <div id="quizModal" class="hidden fixed inset-0 z-[120] flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-md transition-opacity duration-300">
        <div class="bg-white rounded-[2rem] w-full max-w-2xl shadow-2xl relative flex flex-col max-h-[90vh] animate-slide-up border border-slate-200 h-[80vh] md:h-auto">
            <!-- Header -->
            <div class="p-6 border-b border-slate-100 flex flex-col bg-slate-50/50 rounded-t-[2rem]">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="text-xl font-black text-slate-800 flex items-center gap-2">
                            <i class="fas fa-brain text-quiz-600"></i>
                            <span id="quizTitle">Test de connaissances</span>
                        </h3>
                        <p class="text-xs text-slate-500 font-bold uppercase tracking-wide mt-1" id="quizSubtitle">Chapitre : ...</p>
                    </div>
                    <button onclick="closeQuizModal()" class="w-10 h-10 flex items-center justify-center bg-white rounded-full text-slate-400 hover:text-red-500 hover:bg-red-50 shadow-sm transition border border-slate-100">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <!-- Progress Bar -->
                <div class="w-full bg-slate-200 h-2.5 rounded-full overflow-hidden">
                    <div id="quizProgressBar" class="bg-quiz-600 h-full rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                </div>
                <p class="text-right text-[10px] font-bold text-slate-400 mt-1" id="questionProgressText">Question 1/5</p>
            </div>
            
            <!-- Content (Scrollable) -->
            <div id="quizContent" class="p-6 overflow-y-auto flex-grow relative">
                <!-- Dynamic Questions Go Here -->
                <div class="text-center py-10">
                    <i class="fas fa-circle-notch animate-spin text-3xl text-brand-200"></i>
                    <p class="mt-4 text-slate-400 font-bold">Chargement du quiz...</p>
                </div>
            </div>

            <!-- Footer (Actions) -->
            <div class="p-6 border-t border-slate-100 bg-slate-50/50 rounded-b-[2rem] flex justify-between items-center gap-4">
                <div id="quizScoreBox" class="hidden opacity-0 transition-opacity duration-500">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-0.5">Score Final</span>
                    <div class="text-3xl font-black text-quiz-600 leading-none" id="scoreValue">0/0</div>
                </div>
                
                <div class="flex gap-3 ml-auto w-full md:w-auto justify-end" id="quizNavButtons">
                    <!-- Navigation Buttons -->
                    <button id="btnPrev" onclick="changeQuestion(-1)" class="hidden px-5 py-3 bg-white text-slate-600 rounded-xl font-bold hover:bg-slate-100 border border-slate-200 transition">
                        <i class="fas fa-arrow-left text-xs mr-2"></i> Pr√©c√©dent
                    </button>
                    
                    <button id="btnNext" onclick="changeQuestion(1)" class="hidden px-8 py-3 bg-brand-600 text-white rounded-xl font-bold hover:bg-brand-700 shadow-lg shadow-brand-200 transition flex items-center gap-2">
                        <span>Suivant</span>
                        <i class="fas fa-arrow-right text-xs"></i>
                    </button>
                    
                    <button id="btnSubmit" onclick="evaluateQuiz()" class="hidden px-8 py-3 bg-quiz-600 text-white rounded-xl font-black shadow-lg shadow-quiz-200 hover:bg-quiz-700 transition transform active:scale-95 flex items-center gap-2">
                        <span>Valider</span>
                        <i class="fas fa-check"></i>
                    </button>

                    <button id="btnRetry" onclick="resetCurrentQuiz()" class="hidden px-6 py-3 bg-white text-slate-700 rounded-xl font-bold hover:bg-slate-50 border border-slate-200 transition shadow-sm">
                        <i class="fas fa-redo text-xs mr-2"></i> R√©essayer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PREMIUM -->
    <div id="premiumModal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-6 bg-slate-900/80 backdrop-blur-md">
        <div class="bg-white rounded-[3rem] p-8 md:p-10 max-w-md w-full shadow-2xl relative border-4 border-amber-100 animate-slide-up">
            <div class="absolute -top-10 left-1/2 -translate-x-1/2 w-20 h-20 bg-gradient-to-br from-amber-400 to-orange-500 text-white rounded-3xl flex items-center justify-center text-3xl shadow-lg shadow-orange-200 ring-4 ring-white">
                <i class="fas fa-crown"></i>
            </div>
            
            <div class="mt-8 text-center">
                <h2 id="premiumModalTitle" class="text-2xl font-black text-slate-900 mb-2">Passe au niveau sup√©rieur</h2>
                <div class="w-16 h-1 bg-amber-200 mx-auto rounded-full mb-4"></div>
                <p id="premiumModalMsg" class="text-slate-600 mb-8 leading-relaxed font-medium text-sm">
                    D√©bloque l'int√©gralit√© des cours, exercices corrig√©s et vid√©os explicatives pour r√©ussir ton ann√©e.
                </p>
            </div>

            <div class="space-y-3">
                <button id="premiumWhatsappBtn" onclick="contactAdmin()" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-xl font-black shadow-lg shadow-emerald-200 hover:shadow-emerald-300 hover:to-emerald-500 transition flex items-center justify-center gap-3">
                    <i class="fab fa-whatsapp text-xl"></i>
                    <span>Activer pour 2000F / mois</span>
                </button>
                <button onclick="closePremiumModal()" class="w-full py-3 bg-white text-slate-400 rounded-xl font-bold hover:bg-slate-50 hover:text-slate-600 transition text-sm">
                    Non merci, je continue en gratuit
                </button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- CONFIGURATION ---
        const SUPABASE_URL = 'https://nqbyxogfvkmluakwmkmu.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_k5N9blQJIBSj2lW75GckOQ_CrLBqF9N'; 
        
        const sbClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const ADMIN_PHONE = "221768776668";

        // State
        let allCourses = [];
        let currentFilter = 'all';
        let searchQuery = '';
        let currentAuthMode = 'login';
        let currentUser = null;
        
        // Quiz State
        let currentQuizData = null; 
        let currentQuestionIndex = 0;
        let quizUserAnswers = {}; // Map: questionId -> optionId

        // Donn√©es statiques
        const quotes = [
            "Le succ√®s est la somme de petits efforts, r√©p√©t√©s jour apr√®s jour.",
            "En SVT, comprendre le m√©canisme c'est retenir la le√ßon.",
            "L'excellence n'est pas un acte, mais une habitude.",
            "Investir en toi-m√™me rapporte toujours les meilleurs int√©r√™ts.",
            "Ton BAC se pr√©pare d√®s aujourd'hui."
        ];

        // --- INITIALISATION ---
        window.addEventListener('DOMContentLoaded', () => {
            try {
                const stored = localStorage.getItem('svt_user_session');
                if (stored) currentUser = JSON.parse(stored);
            } catch (e) {
                localStorage.removeItem('svt_user_session');
            }

            init();
            
            document.getElementById('searchInput').addEventListener('input', (e) => { 
                searchQuery = e.target.value.trim(); 
                render(); 
            });

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => handleFilterClick(e.target));
            });
        });

        async function init() {
            updateUIForUser();
            showStatus('loader');
            try {
                const { data, error } = await sbClient
    .from('cours')
    .select('*, cours_objectifs(*)')
    .order('id', { ascending: true }); // Classe par ID (1, 2, 3...)
                if (error) throw error;
                allCourses = data || [];
                if (allCourses.length === 0) showStatus('noResults');
                else render();
            } catch (err) {
                console.error("Erreur Supabase:", err);
                showToast("Impossible de charger les cours. V√©rifiez votre connexion.", "error");
                showStatus('noResults');
            }
        }

        // --- CORE UI FUNCTIONS ---
        function render() {
            const grid = document.getElementById('coursesGrid');
            if (!grid) return;

            let filtered = allCourses.filter(c => {
                const matchesSearch = c.titre.toLowerCase().includes(searchQuery.toLowerCase());
                let matchesCategory = true;

                // --- NOUVELLE LOGIQUE DE FILTRAGE ---
                if (currentUser) {
                    // 1. Si l'√©l√®ve est connect√© :
                    // On v√©rifie d'abord si le cours correspond STRICTEMENT √† sa classe
                    if (c.classe !== currentUser.classe) {
                        matchesCategory = false;
                    } else {
                        // Si c'est sa classe, on autorise le filtre "Gratuit" si activ√©
                        if (currentFilter === 'free') matchesCategory = c.type_acces === 'free';
                        // Sinon (si filter est 'all', 'Terminale' ou '3√®me'), on laisse passer car la classe est d√©j√† bonne
                    }
                } else {
                    // 2. Si visiteur (pas connect√©) : Comportement classique avec les boutons
                    if (currentFilter === 'free') matchesCategory = c.type_acces === 'free';
                    else if (currentFilter !== 'all') matchesCategory = c.classe === currentFilter;
                }
                // -------------------------------------

                return matchesSearch && matchesCategory;
            });

            if (filtered.length === 0) {
                showStatus('noResults');
                return;
            }

            hideAllStatus();
            grid.innerHTML = '';

            filtered.forEach((course, index) => {
                const isPremium = course.type_acces === 'premium';
                const card = document.createElement('div');
                card.className = `course-card bg-white rounded-[2rem] p-6 border border-slate-100 flex flex-col h-full relative group animate-slide-up`;
                card.style.animationDelay = `${index * 50}ms`;

                const objectifsHtml = (course.cours_objectifs || []).slice(0, 3).map(o => `
                    <div class="flex items-start gap-2.5 text-xs font-medium text-slate-500">
                        <i class="fas fa-check text-brand-400 mt-0.5 text-[10px]"></i>
                        <span class="leading-relaxed">${o.description}</span>
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-14 h-14 bg-brand-50 text-brand-600 rounded-2xl flex items-center justify-center text-xl shadow-sm group-hover:bg-brand-600 group-hover:text-white transition-colors duration-300">
                            <i class="fas ${course.icone || 'fa-dna'}"></i>
                        </div>
                        <span class="px-3 py-1.5 rounded-full text-[10px] font-black uppercase tracking-wide border ${
                            isPremium 
                            ? 'bg-amber-50 text-amber-600 border-amber-100' 
                            : 'bg-emerald-50 text-emerald-600 border-emerald-100'
                        }">
                            ${isPremium ? '<i class="fas fa-crown mr-1"></i> Premium' : 'Gratuit'}
                        </span>
                    </div>
                    <div class="flex-grow">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-[9px] font-black uppercase tracking-wider text-slate-400 bg-slate-50 px-2 py-1 rounded-md border border-slate-100">${course.classe}</span>
                        </div>
                        <h3 class="text-xl font-extrabold text-slate-900 leading-tight mb-4 group-hover:text-brand-600 transition-colors line-clamp-2">${course.titre}</h3>
                        <div class="space-y-3 mb-6">
                            ${objectifsHtml || '<p class="text-xs text-slate-400 italic">Aucun objectif list√©</p>'}
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 pt-6 border-t border-slate-50 mt-auto">
                         <button onclick="handleAccess('${course.url_vid}', ${isPremium})" class="flex flex-col items-center justify-center gap-1 py-3 rounded-xl bg-slate-900 text-white font-bold text-[10px] hover:bg-slate-800 transition-all active:scale-95 shadow-lg shadow-slate-200">
                            <i class="fas fa-play text-sm"></i> Vid√©o
                        </button>
                        <button onclick="handleQuizAccess('${course.id}', '${course.titre}', ${isPremium})" class="flex flex-col items-center justify-center gap-1 py-3 rounded-xl bg-quiz-600 text-white font-bold text-[10px] hover:bg-quiz-700 transition-all active:scale-95 shadow-lg shadow-quiz-200">
                            <i class="fas fa-brain text-sm"></i> Quiz
                        </button>
                        <button onclick="handleAccess('${course.url_pdf}', ${isPremium})" class="flex flex-col items-center justify-center gap-1 py-3 rounded-xl bg-slate-50 text-slate-600 font-bold text-[10px] hover:bg-slate-100 border border-slate-200 transition-all active:scale-95">
                            <i class="fas fa-file-pdf text-sm"></i> PDF
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- ACCESS CONTROL & QUIZ LOGIC ---

        function handleAccess(url, isPremium) {
            if (!url || url === 'null') { showToast("Ce contenu sera bient√¥t disponible.", "info"); return; }
            if (checkPremiumLock(isPremium)) return;
            window.open(url, '_blank');
        }

        function checkPremiumLock(isPremium) {
            if (isPremium) {
                if (!currentUser) { showAuthModal('login'); showToast("Connecte-toi pour voir ce contenu.", "warning"); return true; }
                if (!currentUser.actif) { showPremiumModal("Contenu Verrouill√©", "Passe en Premium pour 2000F."); return true; }
            }
            return false;
        }

        async function handleQuizAccess(courseId, courseTitle, isPremium) {
            if (checkPremiumLock(isPremium)) return;

            // Reset Quiz State
            currentQuestionIndex = 0;
            quizUserAnswers = {};
            currentQuizData = null;

            document.getElementById('quizTitle').innerText = "Quiz : " + courseTitle;
            document.getElementById('quizModal').classList.remove('hidden');
            document.getElementById('quizContent').innerHTML = `
                <div class="text-center py-10">
                    <i class="fas fa-circle-notch animate-spin text-3xl text-brand-200"></i>
                    <p class="mt-4 text-slate-400 font-bold">Chargement des questions...</p>
                </div>
            `;
            
            // Reset UI
            document.getElementById('quizScoreBox').classList.add('hidden');
            document.getElementById('btnPrev').classList.add('hidden');
            document.getElementById('btnNext').classList.add('hidden');
            document.getElementById('btnSubmit').classList.add('hidden');
            document.getElementById('btnRetry').classList.add('hidden');

            try {
                const { data, error } = await sbClient
                    .from('quiz_questions')
                    .select(`id, question_texte, explication, quiz_options ( id, option_texte, est_correcte )`)
                    .eq('cours_id', courseId);

                if (error) throw error;

                if (!data || data.length === 0) {
                    document.getElementById('quizContent').innerHTML = `
                        <div class="text-center py-10">
                            <h3 class="text-lg font-bold text-slate-700">Quiz en construction</h3>
                            <button onclick="closeQuizModal()" class="mt-6 px-6 py-2 bg-slate-200 rounded-lg">Fermer</button>
                        </div>
                    `;
                    return;
                }

                currentQuizData = data;
                renderSingleQuestion(0);

            } catch (err) {
                console.error("Erreur Quiz:", err);
                showToast("Erreur chargement quiz.", "error");
                closeQuizModal();
            }
        }

        function renderSingleQuestion(index) {
            if(!currentQuizData || !currentQuizData[index]) return;
            
            const q = currentQuizData[index];
            const total = currentQuizData.length;
            
            // Update Progress
            const progressPercent = ((index + 1) / total) * 100;
            document.getElementById('quizProgressBar').style.width = `${progressPercent}%`;
            document.getElementById('questionProgressText').innerText = `Question ${index + 1}/${total}`;

            // Render Question Content
            const container = document.getElementById('quizContent');
            
            let optionsHtml = '';
            q.quiz_options.forEach(opt => {
                const isChecked = quizUserAnswers[q.id] === opt.id ? 'checked' : '';
                optionsHtml += `
                    <label class="option-label block relative group cursor-pointer" onclick="saveAnswer(${q.id}, ${opt.id})">
                        <input type="radio" name="q_current" value="${opt.id}" class="option-radio absolute opacity-0 w-0 h-0 peer" ${isChecked}>
                        <div class="option-content p-4 rounded-xl bg-white border-2 border-slate-200 text-slate-600 font-medium peer-hover:border-brand-200 peer-focus:ring-2 peer-focus:ring-brand-500 transition-all flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full border-2 border-slate-300 flex items-center justify-center peer-checked:border-quiz-500 peer-checked:bg-quiz-500">
                                <div class="w-2 h-2 bg-white rounded-full opacity-0 peer-checked:opacity-100"></div>
                            </div>
                            <span>${opt.option_texte}</span>
                        </div>
                    </label>
                `;
            });

            container.innerHTML = `
                <div class="fade-in">
                    <p class="font-bold text-slate-800 mb-6 text-lg md:text-xl">
                        <span class="text-quiz-500 mr-2 text-2xl font-black">Q${index + 1}.</span> 
                        ${q.question_texte}
                    </p>
                    <div class="space-y-4">
                        ${optionsHtml}
                    </div>
                </div>
            `;

            // Update Buttons
            const btnPrev = document.getElementById('btnPrev');
            const btnNext = document.getElementById('btnNext');
            const btnSubmit = document.getElementById('btnSubmit');

            if (index === 0) btnPrev.classList.add('hidden');
            else btnPrev.classList.remove('hidden');

            if (index === total - 1) {
                btnNext.classList.add('hidden');
                btnSubmit.classList.remove('hidden');
            } else {
                btnNext.classList.remove('hidden');
                btnSubmit.classList.add('hidden');
            }
        }

        function saveAnswer(questionId, optionId) {
            quizUserAnswers[questionId] = optionId;
        }

        function changeQuestion(direction) {
            const newIndex = currentQuestionIndex + direction;
            if (newIndex >= 0 && newIndex < currentQuizData.length) {
                currentQuestionIndex = newIndex;
                renderSingleQuestion(newIndex);
            }
        }

        function evaluateQuiz() {
            if (!currentQuizData) return;

            let score = 0;
            const total = currentQuizData.length;
            let resultHtml = '<div class="space-y-8 fade-in pb-10">';

            currentQuizData.forEach((q, idx) => {
                const userChoiceId = quizUserAnswers[q.id];
                const correctOpt = q.quiz_options.find(o => o.est_correcte);
                const userOpt = q.quiz_options.find(o => o.id === userChoiceId);
                
                let isCorrect = false;
                if(correctOpt && userChoiceId === correctOpt.id) {
                    score++;
                    isCorrect = true;
                }

                // Build correction HTML for this question
                let optionsDisplay = '';
                q.quiz_options.forEach(opt => {
                    let classes = "p-3 rounded-lg border border-slate-100 text-sm flex items-center gap-2";
                    let icon = '';
                    
                    if (opt.id === userChoiceId && opt.est_correcte) {
                        classes = "p-3 rounded-lg border border-emerald-200 bg-emerald-50 text-emerald-800 font-bold";
                        icon = '<i class="fas fa-check text-emerald-600 ml-auto"></i>';
                    } else if (opt.id === userChoiceId && !opt.est_correcte) {
                        classes = "p-3 rounded-lg border border-red-200 bg-red-50 text-red-800 font-bold";
                        icon = '<i class="fas fa-times text-red-500 ml-auto"></i>';
                    } else if (opt.est_correcte) {
                        classes = "p-3 rounded-lg border border-emerald-200 bg-emerald-50 text-emerald-800 font-bold opacity-80";
                        icon = '<span class="text-[10px] bg-emerald-200 text-emerald-800 px-2 py-0.5 rounded ml-auto">R√©ponse correcte</span>';
                    }

                    optionsDisplay += `<div class="${classes}">${opt.option_texte} ${icon}</div>`;
                });

                resultHtml += `
                    <div class="bg-slate-50 p-6 rounded-2xl border ${isCorrect ? 'border-emerald-100' : 'border-red-100'}">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${isCorrect ? 'bg-emerald-100 text-emerald-600' : 'bg-red-100 text-red-600'}">
                                <i class="fas ${isCorrect ? 'fa-check' : 'fa-times'}"></i>
                            </div>
                            <p class="font-bold text-slate-800 pt-1">Q${idx + 1}. ${q.question_texte}</p>
                        </div>
                        <div class="space-y-2 pl-11 mb-4">
                            ${optionsDisplay}
                        </div>
                        <div class="ml-11 p-4 bg-blue-50 text-blue-800 text-xs md:text-sm rounded-xl border border-blue-100">
                            <p class="font-bold mb-1"><i class="fas fa-info-circle mr-1"></i> Explication :</p>
                            ${q.explication || "Pas d'explication disponible."}
                        </div>
                    </div>
                `;
            });
            resultHtml += '</div>';

            // Show Results
            document.getElementById('quizContent').innerHTML = resultHtml;
            document.getElementById('quizScoreBox').classList.remove('hidden', 'opacity-0');
            document.getElementById('scoreValue').innerText = `${score}/${total}`;
            
            // Buttons logic
            document.getElementById('btnPrev').classList.add('hidden');
            document.getElementById('btnNext').classList.add('hidden');
            document.getElementById('btnSubmit').classList.add('hidden');
            document.getElementById('btnRetry').classList.remove('hidden');

            // Scroll top
            document.getElementById('quizContent').scrollTop = 0;

            if (score === total) showToast("F√©licitations ! Un sans faute ! üéâ", "success");
            else if (score >= total / 2) showToast("Bien jou√© ! Continue tes efforts.", "success");
            else showToast("R√©vise encore un peu ce chapitre.", "warning");
        }

        function resetCurrentQuiz() {
            if(currentQuizData) {
                currentQuestionIndex = 0;
                quizUserAnswers = {};
                document.getElementById('quizScoreBox').classList.add('hidden', 'opacity-0');
                document.getElementById('btnRetry').classList.add('hidden');
                renderSingleQuestion(0);
            }
        }

        function closeQuizModal() {
            document.getElementById('quizModal').classList.add('hidden');
            currentQuizData = null;
        }

        // --- AUTH & FILTERS (UNCHANGED) ---
        function handleFilterClick(clickedBtn) {
            const btn = clickedBtn.closest('.filter-btn');
            if(!btn) return;
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.className = 'filter-btn py-3 rounded-xl font-bold transition-all text-xs border border-slate-200 hover:border-brand-300 bg-white text-slate-600 shadow-sm';
            });
            btn.className = 'filter-btn active py-3 rounded-xl font-bold transition-all text-xs bg-brand-600 text-white shadow-lg shadow-brand-200 border border-transparent transform scale-105';
            if (btn.dataset.filter === 'free') btn.classList.add('bg-emerald-600', 'shadow-emerald-200');
            currentFilter = btn.dataset.filter;
            render();
        }
        function resetFilters() { searchQuery = ''; document.getElementById('searchInput').value = ''; document.querySelector('[data-filter="all"]').click(); }
        function updateUIForUser() {
    const authBtns = document.getElementById('navAuthButtons');
    const userDisplay = document.getElementById('navUserDisplay');
    const banner = document.getElementById('welcomeBanner');
    const heroCTA = document.getElementById('heroCTA'); // On r√©cup√®re le bloc

    if (currentUser) {
        // L'utilisateur est connect√©
        authBtns.classList.add('hidden');
        userDisplay.classList.remove('hidden');
        banner.classList.remove('hidden');
        
        if (heroCTA) heroCTA.classList.add('hidden'); // On cache le bouton Commencer
        
        // ... reste du code (initiales, nom, etc.) ...
        const initials = currentUser.nom.charAt(0).toUpperCase();
        document.getElementById('userNameNav').innerText = currentUser.nom.split(' ')[0];
        document.getElementById('userClassNav').innerText = currentUser.classe;
        document.getElementById('userInitialNav').innerText = initials;
        document.getElementById('welcomeUserText').innerText = `${currentUser.nom}`;
        document.getElementById('userInitial').innerText = initials;
        document.getElementById('motivationQuote').innerText = quotes[Math.floor(Math.random() * quotes.length)];
    } else {
        // L'utilisateur est d√©connect√©
        authBtns.classList.remove('hidden');
        userDisplay.classList.add('hidden');
        banner.classList.add('hidden');
        
        if (heroCTA) heroCTA.classList.remove('hidden'); // On r√©affiche le bouton Commencer
    }
}
        function showAuthModal(mode) {
            currentAuthMode = mode; document.getElementById('authModal').classList.remove('hidden');
            const s=document.getElementById('signupFields'), l=document.getElementById('loginFields'), t=document.getElementById('authTitle'), b=document.getElementById('authBtnLabel'), ft=document.getElementById('authFooterText'), fb=document.getElementById('authFooterBtn');
            if (mode === 'signup') { s.classList.remove('hidden'); l.classList.add('hidden'); t.innerText = "Inscription Gratuite"; b.innerText = "Cr√©er mon ID"; ft.innerText = "D√©j√† un ID ?"; fb.innerText = "Se connecter"; }
            else { s.classList.add('hidden'); l.classList.remove('hidden'); t.innerText = "Espace √âl√®ve"; b.innerText = "Se connecter"; ft.innerText = "Nouveau ?"; fb.innerText = "Cr√©er un compte"; }
        }
        function toggleAuthMode() { showAuthModal(currentAuthMode === 'login' ? 'signup' : 'login'); }
        function closeAuthModal() { document.getElementById('authModal').classList.add('hidden'); }
async function handleAuth(e) {
    e.preventDefault(); 
    const btn = document.getElementById('authSubmitBtn'); 
    const orig = btn.innerHTML;
    btn.disabled = true; 
    btn.innerHTML = '<i class="fas fa-circle-notch animate-spin"></i> Traitement...';

    try {
        if (currentAuthMode === 'signup') {
            const nom = document.getElementById('regFullName').value.trim();
            const classe = document.getElementById('regClasse').value;

            // 1. V√©rification des champs vides
            if (!nom || !classe) throw new Error("Champs manquants.");

            // 2. Forcer Pr√©nom ET Nom (au moins deux mots)
            const nameParts = nom.split(' ').filter(p => p.length > 0);
            if (nameParts.length < 2) {
                throw new Error("Veuillez entrer votre pr√©nom ET votre nom complet.");
            }

            // 3. V√©rification des doublons dans Supabase
            const { data: existingUser, error: checkError } = await sbClient
                .from('eleves')
                .select('id')
                .ilike('nom', nom) // 'ilike' pour ignorer la casse (Majuscules/Minuscules)
                .maybeSingle();

            if (checkError) throw checkError;
            if (existingUser) {
                throw new Error("Ce nom est d√©j√† inscrit. Si c'est vous, contactez l'admin ou ajoutez un 2√®me pr√©nom.");
            }

            // 4. Cr√©ation du compte si tout est OK
            const id = generateEleveID();
            const { error } = await sbClient.from('eleves').insert([{ id, nom, classe, actif: false }]);
            
            if (error) throw error;

            showToast(`Compte cr√©√© ! ID: ${id}`, "success");
            
            // Message WhatsApp personnalis√© (commercial)
            const whatsappMsg = `Salut SVT Excellence ! üëã\n\n` +
                                `Je viens de cr√©er mon compte.\n` +
                                `üë§ Nom complet : *${nom}* \n` +
                                `üè´ Classe : *${classe}*\n` +
                                `üîë Mon ID unique : *${id}*\n\n` +
                                `Je voudrais valider mon inscription.`;

            setTimeout(() => { 
                window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(whatsappMsg)}`, '_blank'); 
                closeAuthModal(); 
            }, 1500);

        } else {
            // ... (le reste du code pour la connexion reste inchang√©)
            const id = document.getElementById('loginID').value.toUpperCase().trim();
            if (id.length < 4) throw new Error("ID invalide.");
            const { data, error } = await sbClient.from('eleves').select('*').eq('id', id).single();
            if (error || !data) throw new Error("ID introuvable.");
            currentUser = data; localStorage.setItem('svt_user_session', JSON.stringify(data));
            showToast(`Bienvenue ${data.nom.split(' ')[0]}`, "success"); updateUIForUser(); closeAuthModal(); render();
        }
    } catch (err) { 
        showToast(err.message, "error"); 
    } finally { 
        btn.disabled = false; 
        btn.innerHTML = orig; 
    }
}
        function generateEleveID() { const c='ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; let r=''; for(let i=0;i<4;i++) r+=c.charAt(Math.floor(Math.random()*c.length)); return r; }
        function logout() { localStorage.removeItem('svt_user_session'); currentUser = null; updateUIForUser(); showToast("D√©connect√©", "info"); render(); }
        function showPremiumModal(t, m) { document.getElementById('premiumModalTitle').innerText = t; document.getElementById('premiumModalMsg').innerText = m; document.getElementById('premiumModal').classList.remove('hidden'); }
        function closePremiumModal() { document.getElementById('premiumModal').classList.add('hidden'); }
        function contactAdmin() {
    let message = "";

    if (currentUser) {
        // Cas : L'√©l√®ve est connect√© -> Message commercial de vente
        message = `Bonjour, c'est *${currentUser.nom}* (Classe: ${currentUser.classe}).\n` +
                  `Mon Identifiant est : *${currentUser.id}*.\n\n` +
                  `Je souhaite activer mon *Pack Premium* pour acc√©der √† toutes les vid√©os et exercices corrig√©s. üöÄ\n` +
                  `Quels sont les moyens de paiement ?`;
    } else {
        // Cas : Visiteur non connect√© -> Message de curiosit√©
        message = `Bonjour, je suis int√©ress√© par les cours de SVT Excellence.\n` +
                  `Pouvez-vous m'expliquer comment s'inscrire et comment √ßa marche ?`;
    }

    // Ouverture de WhatsApp avec le message encod√©
    window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(message)}`, '_blank');
}
        // --- AJOUTER CETTE FONCTION DANS LE SCRIPT ---

function orderManual() {
    // Le message WhatsApp pr√©-rempli
    const message = `Bonjour SVT Excellence ! üëã\n\n` +
                    `Je suis int√©ress√© par le manuel *Le Dompteur des Sciences de la Vie et de la Terre* üìò.\n\n` +
                    `Je sais qu'il contient :\n` +
                    `‚úÖ Les √©preuves du BAC corrig√©es\n` +
                    `‚úÖ Des fiches de synth√®se (Neuro, Immuno, G√©n√©tique...)\n` +
                    `‚úÖ Des sch√©mas et analyses de documents\n\n` +
                    `Je souhaite le commander. Quel est le prix et comment se passe la livraison ?`;

    // Ouverture de WhatsApp
    window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(message)}`, '_blank');
}
        function showStatus(id) { hideAllStatus(); document.getElementById('statusContainer').classList.remove('hidden'); document.getElementById(id).classList.remove('hidden'); document.getElementById('coursesGrid').classList.add('hidden'); }
        function hideAllStatus() { document.getElementById('statusContainer').classList.add('hidden'); document.getElementById('loader').classList.add('hidden'); document.getElementById('noResults').classList.add('hidden'); document.getElementById('coursesGrid').classList.remove('hidden'); }
        function showToast(m, t='info') {
            const c = document.getElementById('toastContainer'); let bg='bg-white', ic='fa-info-circle text-blue-500', bc='border-blue-500';
            if (t==='success') { ic='fa-check-circle text-emerald-500'; bc='border-emerald-500'; }
            else if (t==='error') { ic='fa-exclamation-circle text-red-500'; bc='border-red-500'; }
            else if (t==='warning') { ic='fa-bell text-amber-500'; bc='border-amber-500'; }
            const d = document.createElement('div'); d.className = `transform translate-x-full transition-all duration-500 ease-out flex items-center gap-3 px-4 py-3 rounded-r-lg shadow-xl shadow-slate-200 ${bg} border-l-4 ${bc} min-w-[300px] pointer-events-auto`;
            d.innerHTML = `<i class="fas ${ic} text-lg"></i><p class="text-sm font-bold text-slate-700">${m}</p>`;
            c.appendChild(d); requestAnimationFrame(() => d.classList.remove('translate-x-full')); setTimeout(() => { d.classList.add('translate-x-full', 'opacity-0'); setTimeout(() => d.remove(), 500); }, 3500);
        }
    </script>
</body>
</html>
