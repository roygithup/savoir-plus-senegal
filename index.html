<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVT Excellence | R√©ussir pour 1000F</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 
                            500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .glass-nav { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(226, 232, 240, 0.8); }
        .course-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .course-card:hover { transform: translateY(-8px); box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.15); }
        .shimmer { background: linear-gradient(90deg, #f0f0f0 25%, #f8f8f8 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .scale-in { animation: scaleIn 0.3s ease-out; }
        @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .text-gradient { background: linear-gradient(to right, #2563eb, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="bg-[#F8FAFC] text-slate-900 min-h-screen font-sans antialiased">

    <!-- NAVIGATION -->
    <nav class="glass-nav sticky top-0 z-50 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="window.location.reload()">
                <div class="bg-brand-600 p-2 rounded-xl text-white shadow-lg shadow-brand-200">
                    <i class="fas fa-dna text-xl"></i>
                </div>
                <span class="text-xl font-extrabold tracking-tight text-brand-900">SVT<span class="text-brand-600">Excellence</span></span>
            </div>

            <div class="flex items-center gap-4">
                <div id="navAuthButtons" class="flex items-center gap-2">
                    <button onclick="showAuthModal('login')" class="text-slate-600 font-bold text-sm hover:text-brand-600 px-4 py-2 transition">Connexion</button>
                    <button onclick="showAuthModal('signup')" class="bg-brand-600 text-white px-6 py-2.5 rounded-xl font-bold text-sm shadow-xl shadow-brand-100 hover:bg-brand-700 transition transform hover:scale-105 active:scale-95">S'inscrire (C'est gratuit)</button>
                </div>
                <div id="navUserDisplay" class="hidden flex items-center gap-3">
                    <div class="flex items-center gap-2 bg-slate-100 px-3 py-1.5 rounded-xl border border-slate-200">
                        <div class="w-6 h-6 rounded-full bg-brand-600 text-white flex items-center justify-center text-[10px] font-bold" id="userInitialNav">?</div>
                        <span id="userNameNav" class="text-xs font-bold text-slate-700 max-w-[100px] truncate">Utilisateur</span>
                    </div>
                    <button onclick="logout()" class="text-red-500 hover:bg-red-50 w-10 h-10 flex items-center justify-center rounded-xl transition border border-red-100"><i class="fas fa-sign-out-alt"></i></button>
                </div>
            </div>
        </div>
    </nav>

    <!-- BANNI√àRE BIENVENUE -->
    <div id="welcomeBanner" class="hidden bg-slate-900 text-white py-4 px-6 border-b border-white/10">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-2xl bg-brand-600 flex items-center justify-center font-black text-white shadow-lg shadow-brand-900/50" id="userInitial">U</div>
                <div>
                    <p class="text-xs text-slate-400 font-bold uppercase tracking-widest">Tableau de bord</p>
                    <p class="font-extrabold text-lg" id="welcomeUserText">Nom de l'√©l√®ve</p>
                </div>
            </div>
            <div class="bg-white/5 px-6 py-3 rounded-2xl text-sm italic text-slate-300 border border-white/10 flex items-center gap-4 max-w-xl">
                <i class="fas fa-quote-left text-brand-500 opacity-50"></i>
                <span id="motivationQuote">Chargement de votre dose de motivation...</span>
            </div>
        </div>
    </div>

    <!-- HERO SECTION -->
    <header class="bg-white border-b border-slate-100 px-6 py-16 relative overflow-hidden">
        <div class="absolute top-0 right-0 -mr-24 -mt-24 w-96 h-96 bg-brand-50 rounded-full blur-[120px] opacity-60"></div>
        <div class="absolute bottom-0 left-0 -ml-24 -mb-24 w-64 h-64 bg-purple-50 rounded-full blur-[100px] opacity-40"></div>
        
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-12 relative z-10">
            <div class="max-w-2xl text-center md:text-left">
                <div class="inline-flex items-center gap-2 bg-emerald-50 text-emerald-700 px-4 py-2 rounded-full text-xs font-black mb-6 border border-emerald-100 tracking-wider uppercase">
                    <i class="fas fa-gift"></i>
                    L'inscription est totalement gratuite
                </div>
                <h1 class="text-4xl md:text-6xl font-black text-slate-900 mb-6 leading-[1.15]">
                    Vise le <span class="text-gradient">20/20</span> en SVT pour seulement <span class="underline decoration-brand-500 decoration-4 underline-offset-8">1000F</span>
                </h1>
                <p class="text-slate-600 text-lg md:text-xl mb-8 leading-relaxed font-medium">
                    Pourquoi rester dans le doute ? Acc√®de aux cours, vid√©os et sch√©mas qui font la diff√©rence entre un √©l√®ve moyen et l'√©lite.
                </p>
                
                <div class="flex flex-col sm:flex-row items-center gap-4 justify-center md:justify-start">
                    <div class="p-5 bg-white rounded-3xl border border-slate-200 shadow-xl flex items-center gap-5 group hover:border-brand-300 transition-colors">
                        <div class="w-12 h-12 bg-brand-600 text-white rounded-2xl flex items-center justify-center text-xl shadow-lg shadow-brand-200">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="text-left">
                            <div class="text-2xl font-black text-slate-900 leading-none">1000F <span class="text-sm font-bold text-slate-400">/ mois</span></div>
                            <div class="text-[11px] font-bold text-brand-600 uppercase tracking-tighter mt-1">Garantie ton succ√®s au BAC/BFEM</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="w-full md:w-auto bg-slate-50 p-6 rounded-[2.5rem] border border-slate-200 shadow-inner">
                <div class="flex flex-col gap-3 min-w-[280px]">
                    <div class="relative mb-2">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                        <input type="text" id="searchInput" placeholder="Chercher une le√ßon..." class="w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-2xl focus:ring-2 focus:ring-brand-500 outline-none transition font-bold text-sm shadow-sm">
                    </div>
                    <div class="flex flex-col gap-2" id="filterContainer">
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 ml-2">Ta Classe</p>
                        <div class="grid grid-cols-2 gap-2">
                            <button data-filter="all" class="filter-btn py-3 rounded-2xl font-bold transition-all bg-brand-600 text-white text-xs shadow-lg shadow-brand-100">Tous les cours</button>
                            <button data-filter="free" class="filter-btn py-3 rounded-2xl font-bold transition-all bg-white text-emerald-600 border border-emerald-100 hover:bg-emerald-50 text-xs shadow-sm">Zone Gratuite</button>
                            <button data-filter="Terminale" class="filter-btn py-3 rounded-2xl font-bold transition-all bg-white text-slate-600 border border-slate-200 hover:border-brand-300 text-xs shadow-sm">Terminale</button>
                            <button data-filter="3√®me" class="filter-btn py-3 rounded-2xl font-bold transition-all bg-white text-slate-600 border border-slate-200 hover:border-brand-300 text-xs shadow-sm">3√®me</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- CONTENT -->
    <main class="max-w-7xl mx-auto px-6 py-16">
        <div id="statusContainer" class="hidden text-center py-20">
            <div id="loader" class="hidden flex flex-col items-center">
                <div class="w-16 h-16 border-4 border-brand-100 border-t-brand-600 rounded-full animate-spin"></div>
                <p class="mt-4 font-bold text-slate-400">Pr√©paration de vos cours...</p>
            </div>
            <div id="noResults" class="hidden text-slate-400">
                <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-search text-2xl"></i>
                </div>
                <h3 class="text-2xl font-black text-slate-800">Rien √† l'horizon</h3>
                <p class="font-medium mt-2">Essaie une autre recherche ou change de niveau.</p>
            </div>
        </div>

        <div id="coursesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
            <!-- Loading Skeletons -->
            <div class="shimmer h-[400px] rounded-[2.5rem] opacity-40"></div>
            <div class="shimmer h-[400px] rounded-[2.5rem] opacity-40"></div>
            <div class="shimmer h-[400px] rounded-[2.5rem] opacity-40"></div>
        </div>
    </main>

    <!-- MODAL AUTH -->
    <div id="authModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-slate-900/80 backdrop-blur-md">
        <div class="bg-white rounded-[2.5rem] p-10 max-w-md w-full shadow-2xl scale-in relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeAuthModal()" class="absolute top-8 right-8 text-slate-400 hover:text-slate-900 transition h-10 w-10 flex items-center justify-center bg-slate-50 rounded-xl">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center mb-10">
                <div id="authIconBox" class="w-20 h-20 bg-brand-50 text-brand-600 rounded-3xl flex items-center justify-center text-3xl mx-auto mb-6 shadow-inner">
                    <i id="authIcon" class="fas fa-user-graduate"></i>
                </div>
                <h2 id="authTitle" class="text-3xl font-black text-slate-900 leading-tight">Acc√®s El√®ve</h2>
                <p id="authSubtitle" class="text-slate-500 mt-2 font-medium italic">L'excellence commence ici.</p>
            </div>

            <form id="authForm" onsubmit="handleAuth(event)" class="space-y-5">
                <div id="signupFields" class="hidden space-y-5">
                    <div class="bg-emerald-50 border border-emerald-100 p-4 rounded-2xl mb-4">
                        <p class="text-[11px] text-emerald-700 font-black uppercase tracking-widest text-center">üéâ Inscription 100% Gratuite</p>
                    </div>
                    <div>
                        <label class="block text-xs font-black text-slate-500 uppercase tracking-widest mb-2 ml-1">Ton Nom Complet</label>
                        <input type="text" id="regFullName" placeholder="Moussa Diop" class="w-full px-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-brand-500 outline-none transition font-bold">
                    </div>
                    <div>
                        <label class="block text-xs font-black text-slate-500 uppercase tracking-widest mb-2 ml-1">Ta Classe</label>
                        <select id="regClasse" class="w-full px-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-brand-500 outline-none transition font-bold appearance-none">
                            <option value="">S√©lectionne ton niveau</option>
                            <option value="Terminale">Terminale</option>
                            <option value="3√®me">3√®me</option>
                        </select>
                    </div>
                </div>

                <div id="loginFields">
                    <div>
                        <label class="block text-xs font-black text-slate-500 uppercase tracking-widest mb-3 text-center">Ton ID d'acc√®s (4 caract√®res)</label>
                        <input type="text" id="loginID" maxlength="4" placeholder="ABCD" class="w-full px-5 py-6 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-brand-500 outline-none transition uppercase text-center text-3xl font-black tracking-[0.5em] shadow-inner text-brand-600">
                    </div>
                </div>
                
                <button type="submit" id="authSubmitBtn" class="w-full py-5 bg-brand-600 text-white rounded-[1.5rem] font-black shadow-2xl shadow-brand-200 hover:bg-brand-700 transition transform hover:-translate-y-1 active:translate-y-0 flex items-center justify-center gap-3">
                    <span id="authBtnLabel">Se connecter</span>
                    <i class="fas fa-rocket text-sm"></i>
                </button>
            </form>

            <div class="mt-8 pt-8 border-t border-slate-100 text-center">
                <p class="text-sm font-bold text-slate-400">
                    <span id="authFooterText">Pas encore de compte ?</span>
                    <button onclick="toggleAuthMode()" id="authFooterBtn" class="text-brand-600 font-black hover:underline ml-1">S'inscrire gratuitement</button>
                </p>
            </div>
        </div>
    </div>

    <!-- MODAL PREMIUM / WHATSAPP -->
    <div id="premiumModal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-6 bg-brand-900/90 backdrop-blur-lg">
        <div class="bg-white rounded-[3rem] p-10 max-w-md w-full shadow-2xl scale-in border border-white/20">
            <div id="premiumIconContainer" class="w-20 h-20 bg-amber-50 text-amber-600 rounded-3xl flex items-center justify-center text-3xl mb-8 shadow-inner border border-amber-100 mx-auto">
                <i class="fas fa-crown"></i>
            </div>
            <h2 id="premiumModalTitle" class="text-3xl font-black text-slate-900 mb-4 text-center">Pr√™t pour l'Excellence ?</h2>
            <p id="premiumModalMsg" class="text-slate-600 mb-10 leading-relaxed text-center font-medium">
                Cette le√ßon va transformer tes r√©sultats. Pour seulement <span class="font-black text-brand-600">1000F</span>, acc√®de √† tout le contenu Premium pendant 30 jours.
            </p>
            <div class="space-y-4">
                <button id="premiumWhatsappBtn" onclick="contactAdmin()" class="w-full py-5 bg-brand-600 text-white rounded-[1.5rem] font-black shadow-xl shadow-brand-300 hover:bg-brand-700 transition flex items-center justify-center gap-3">
                    <i class="fab fa-whatsapp text-xl"></i>
                    <span>Activer pour 1000F / mois</span>
                </button>
                <button onclick="closePremiumModal()" class="w-full py-4 bg-slate-50 text-slate-400 rounded-[1.2rem] font-bold hover:bg-slate-100 transition">Peut-√™tre plus tard</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const SUPABASE_URL = 'https://nqbyxogfvkmluakwmkmu.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_k5N9blQJIBSj2lW75GckOQ_CrLBqF9N'; 
        
        // Initialisation de Supabase (correction de la double d√©claration)
        const sbClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const ADMIN_PHONE = "221768776668";

        let allCourses = [];
        let currentFilter = 'all';
        let searchQuery = '';
        let currentAuthMode = 'login';
        let currentUser = JSON.parse(localStorage.getItem('svt_user_session')) || null;

        const quotes = [
            "Le succ√®s est la somme de petits efforts, r√©p√©t√©s jour apr√®s jour.",
            "En SVT, on n'apprend pas seulement des faits, on apprend √† comprendre la vie.",
            "Celui qui pose une question risque de passer pour un sot cinq minutes, celui qui n'en pose pas reste un sot toute sa vie.",
            "L'intelligence, c'est la facult√© d'adaptation.",
            "Il n'y a pas de r√©ussite sans travail acharn√©. Ton 1000F est un investissement, pas une d√©pense.",
            "Ton cerveau est ton meilleur alli√©, nourris-le d'Excellence."
        ];

        // INITIALISATION
        async function init() {
            updateUIForUser();
            showStatus('loader');
            try {
                const { data, error } = await sbClient.from('cours').select('*, cours_objectifs(*)');
                if (error) throw error;
                allCourses = data || [];
                render();
            } catch (err) {
                console.error("Erreur chargement cours:", err);
                showStatus('noResults');
            }
        }

        // GESTION UI UTILISATEUR
        function updateUIForUser() {
            const authBtns = document.getElementById('navAuthButtons');
            const userDisplay = document.getElementById('navUserDisplay');
            const banner = document.getElementById('welcomeBanner');

            if (currentUser) {
                authBtns.classList.add('hidden');
                userDisplay.classList.remove('hidden');
                banner.classList.remove('hidden');
                
                document.getElementById('userNameNav').innerText = currentUser.nom;
                document.getElementById('userInitialNav').innerText = currentUser.nom.charAt(0).toUpperCase();
                document.getElementById('welcomeUserText').innerText = `${currentUser.nom} ‚Ä¢ ${currentUser.classe}`;
                document.getElementById('userInitial').innerText = currentUser.nom.charAt(0).toUpperCase();
                document.getElementById('motivationQuote').innerText = quotes[Math.floor(Math.random() * quotes.length)];
            } else {
                authBtns.classList.remove('hidden');
                userDisplay.classList.add('hidden');
                banner.classList.add('hidden');
            }
        }

        // AUTHENTIFICATION
        function generateEleveID() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; 
            let code = '';
            for (let i = 0; i < 4; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));
            return code;
        }

        async function handleAuth(event) {
            event.preventDefault();
            const btn = document.getElementById('authSubmitBtn');
            const originalBtnHtml = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-circle-notch animate-spin"></i>';

            try {
                if (currentAuthMode === 'signup') {
                    const nom = document.getElementById('regFullName').value.trim();
                    const classe = document.getElementById('regClasse').value;
                    const eleveID = generateEleveID();

                    if (!nom || !classe) throw new Error("Veuillez remplir tous les champs.");

                    const { error } = await sbClient.from('eleves').insert([{ id: eleveID, nom, classe, actif: false }]);
                    if (error) throw error;

                    const msg = `Bonjour SVT Excellence ! üëã\n\nInscription gratuite r√©ussie :\nüÜî ID : ${eleveID}\nüë§ Nom : ${nom}\nüìö Classe : ${classe}\n\nJe souhaite activer mon acc√®s Premium pour 1000F.`;
                    
                    alert(`Compte gratuit cr√©√© ! \nNote bien ton ID : ${eleveID}\n\nOn passe sur WhatsApp pour l'activation.`);
                    window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
                    closeAuthModal();
                } else {
                    const enteredID = document.getElementById('loginID').value.toUpperCase().trim();
                    if (!enteredID) throw new Error("L'ID est obligatoire.");

                    const { data: user, error } = await sbClient.from('eleves').select('*').eq('id', enteredID).single();

                    if (error || !user) throw new Error("Cet ID n'existe pas. V√©rifie ton code ou inscris-toi gratuitement.");

                    // V√©rification Validit√©
                    const now = new Date();
                    const expiration = user.date_expiration ? new Date(user.date_expiration) : null;
                    const isExpired = expiration ? now > expiration : true;

                    if (!user.actif || isExpired) {
                        closeAuthModal();
                        showPremiumModal(
                            `Ravi de te revoir, ${user.nom} !`,
                            `Ton ID est bien reconnu, mais ton acc√®s Premium est ${!user.actif ? 'inactif' : 'expir√©'}. D√©bloque toutes tes le√ßons pour seulement 1000F.`
                        );
                        return;
                    }

                    currentUser = user;
                    localStorage.setItem('svt_user_session', JSON.stringify(user));
                    alert(`Acc√®s autoris√©. Pr√©pare-toi √† l'excellence, ${user.nom} !`);
                    updateUIForUser();
                    closeAuthModal();
                    render();
                }
            } catch (err) {
                alert(err.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalBtnHtml;
            }
        }

        function logout() {
            if(confirm("Veux-tu vraiment te d√©connecter ?")) {
                localStorage.removeItem('svt_user_session');
                currentUser = null;
                updateUIForUser();
                render();
            }
        }

        // AFFICHAGE DES COURS
        function render() {
            const grid = document.getElementById('coursesGrid');
            if (!grid) return;

            let filtered = allCourses.filter(c => {
                const matchesSearch = c.titre.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesCategory = currentFilter === 'all' || c.classe === currentFilter || (currentFilter === 'free' && c.type_acces === 'free');
                return matchesSearch && matchesCategory;
            });

            grid.innerHTML = '';
            hideAllStatus();

            if (filtered.length === 0) {
                showStatus('noResults');
                return;
            }

            filtered.forEach(course => {
                const isPremium = course.type_acces === 'premium';
                const card = document.createElement('div');
                card.className = `course-card bg-white rounded-[3rem] p-8 border border-slate-100 flex flex-col h-full relative group hover:border-brand-100`;
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-8">
                        <div class="w-16 h-16 bg-brand-50 text-brand-600 rounded-2xl flex items-center justify-center text-2xl group-hover:bg-brand-600 group-hover:text-white group-hover:rotate-6 transition-all duration-500">
                            <i class="fas ${course.icone || 'fa-dna'}"></i>
                        </div>
                        <span class="px-4 py-2 rounded-2xl text-[10px] font-black uppercase tracking-widest ${isPremium ? 'bg-amber-50 text-amber-600 border border-amber-100' : 'bg-emerald-50 text-emerald-600 border border-emerald-100'}">
                            ${isPremium ? '<i class="fas fa-crown mr-1"></i> Premium' : '<i class="fas fa-check mr-1"></i> Gratuit'}
                        </span>
                    </div>
                    <div class="flex-grow">
                        <p class="text-brand-600 text-[10px] font-black uppercase tracking-[0.2em] mb-3">${course.classe}</p>
                        <h3 class="text-2xl font-black text-slate-900 leading-tight mb-6 group-hover:text-brand-600 transition-colors">${course.titre}</h3>
                        <div class="space-y-4 mb-8">
                            ${(course.cours_objectifs || []).slice(0, 3).map(o => `
                                <div class="flex items-start gap-3 text-sm font-medium text-slate-500">
                                    <div class="w-1.5 h-1.5 rounded-full bg-brand-400 mt-1.5 shrink-0"></div>
                                    <span class="leading-tight">${o.description}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 pt-8 border-t border-slate-50">
                        <button onclick="handleAccess('${course.url_vid}', ${isPremium})" class="flex items-center justify-center gap-2 py-4 rounded-2xl bg-slate-900 text-white font-black text-xs hover:bg-brand-600 transition-all active:scale-95 shadow-lg shadow-slate-200">
                            <i class="fas fa-play"></i> Vid√©o
                        </button>
                        <button onclick="handleAccess('${course.url_pdf}', ${isPremium})" class="flex items-center justify-center gap-2 py-4 rounded-2xl bg-slate-50 text-slate-700 font-black text-xs hover:bg-slate-200 transition-all active:scale-95 border border-slate-100">
                            <i class="fas fa-file-pdf"></i> PDF
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function handleAccess(url, isPremium) {
            if (isPremium && !currentUser) {
                showPremiumModal(
                    "Contenu d'Excellence", 
                    "Cette le√ßon est la cl√© pour booster tes notes. Acc√®de √† tout le programme Premium pour seulement 1000F par mois."
                );
            } else {
                window.open(url, '_blank');
            }
        }

        // MODALS
        function showAuthModal(mode) {
            currentAuthMode = mode;
            const modal = document.getElementById('authModal');
            const signupFields = document.getElementById('signupFields');
            const loginFields = document.getElementById('loginFields');
            const title = document.getElementById('authTitle');
            const btnLabel = document.getElementById('authBtnLabel');
            const footerBtn = document.getElementById('authFooterBtn');
            const footerText = document.getElementById('authFooterText');

            if (mode === 'signup') {
                signupFields.classList.remove('hidden');
                loginFields.classList.add('hidden');
                title.innerText = "Cr√©ation Gratuite";
                btnLabel.innerText = "S'inscrire (Gratuit)";
                footerText.innerText = "D√©j√† √©l√®ve ?";
                footerBtn.innerText = "Se connecter";
                document.getElementById('authIcon').className = "fas fa-user-plus";
            } else {
                signupFields.classList.add('hidden');
                loginFields.classList.remove('hidden');
                title.innerText = "Bon retour !";
                btnLabel.innerText = "C'est parti !";
                footerText.innerText = "Nouveau ici ?";
                footerBtn.innerText = "S'inscrire gratuitement";
                document.getElementById('authIcon').className = "fas fa-user-graduate";
            }
            modal.classList.remove('hidden');
        }

        function toggleAuthMode() { showAuthModal(currentAuthMode === 'login' ? 'signup' : 'login'); }
        
        function closeAuthModal() { 
            document.getElementById('authModal').classList.add('hidden'); 
            document.getElementById('authForm').reset();
        }

        function showPremiumModal(title, msg) { 
            const modal = document.getElementById('premiumModal');
            document.getElementById('premiumModalTitle').innerText = title || "Acc√®s Premium";
            document.getElementById('premiumModalMsg').innerText = msg || "D√©bloquez tout pour 1000F.";
            modal.classList.remove('hidden');
        }

        function closePremiumModal() { 
            document.getElementById('premiumModal').classList.add('hidden'); 
        }

        function contactAdmin() {
            const userPart = currentUser ? `Mon ID est ${currentUser.id}.` : "Je souhaite m'inscrire.";
            const msg = `Bonjour SVT Excellence ! üëã\n\nJe souhaite activer mon abonnement Premium √† 1000F / mois. ${userPart}`;
            window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        // FILTRES ET RECHERCHE
        document.getElementById('searchInput')?.addEventListener('input', (e) => { 
            searchQuery = e.target.value; 
            render(); 
        });
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => {
                    b.className = 'filter-btn py-3 rounded-2xl font-bold transition-all bg-white text-slate-600 border border-slate-200 hover:border-brand-300 text-xs shadow-sm';
                    if(b.dataset.filter === 'free') b.classList.add('text-emerald-600', 'border-emerald-100');
                });
                
                btn.className = 'filter-btn py-3 rounded-2xl font-bold transition-all bg-brand-600 text-white text-xs shadow-lg shadow-brand-100';
                currentFilter = btn.dataset.filter;
                render();
            });
        });

        function showStatus(id) {
            hideAllStatus();
            document.getElementById('statusContainer').classList.remove('hidden');
            document.getElementById(id).classList.remove('hidden');
            document.getElementById('coursesGrid').classList.add('hidden');
        }

        function hideAllStatus() {
            document.getElementById('statusContainer').classList.add('hidden');
            document.getElementById('coursesGrid').classList.remove('hidden');
        }

        window.onload = init;
    </script>
</body>
</html>
